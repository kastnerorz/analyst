<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css"> <!-- #409EFF -->
    <title>类别</title>
</head>
<body>
<div id="app">
    <el-container>
        <el-header style="border-bottom: #409EFF">
            <el-row type="flex" justify="center">
                <el-col :span="12">
                    <el-row :gutter="20">
                        <el-col :span="4">
                            <span style="color:#409EFF;font-size: 30px;height: 40px;">智购</span>
                        </el-col>
                        <el-col :span="10">
                            <el-input prefix-icon="el-icon-search" placeholder="请输入内容" v-model="keyword" @keyup.native.enter="search" clearable></el-input>
                        </el-col>
                        <el-col :span="2" :offset="6">
                            <el-button type="text">清单</el-button>
                        </el-col>
                        <el-col :span="2">
                            <el-button type="text">排行</el-button>
                        </el-col>
                    </el-row>
                </el-col>
            </el-row>
        </el-header>
        <el-main style="padding:0">
            <el-row type="flex">
                <el-col :span="18">
                    <div style="padding:0 20px 20px 0">
                        <el-button type="primary" class="button" @click="report">生成{{ keyword }}类别报告</el-button>
                    </div>
                </el-col>
            </el-row>
            <el-row type="flex">
                <el-col :span="18">
                    <!-- main content -->
                    <el-row type="flex" style="flex-direction: row; flex-wrap: wrap" :gutter="5">
                        <el-col :span="6" :key="index" v-for="(item, index) in items">
                            <el-card :body-style="{ padding: '0px' }" justify="center" style="margin-bottom: 10px;">
                                <div style="text-align: center;padding-top:20px">
                                    <img :src='"https://img11.360buyimg.com/n1/s450x450_" + item.imageList.split(",")[0]' class="image" width="100%">
                                </div>
                                <div style="padding: 14px;height:28px;">
                                    <span style="color:#c73420" v-if="item.priceList.length">￥ {{ item.priceList[0].price }}&nbsp</span>
                                    <span style="font-size: 12px">（<span style="color:#c73420">{{ item.commentCountStr}}</span>
                                        <span v-if="item.commentCountStr === null">暂无</span>评论）</span>
                                </div>
                                <div style="height:25px;padding-left:12px;">
                                    <p style="font-weight: bold;margin: 0px;">{{ item.zhName }}</p>
                                </div>
                                <div class="bottom clearfix" style="padding-left:12px;">
                                    <el-button type="text" class="button" @click="singleAnalyst(item.skuId)">查看分析</el-button>
                                </div>
                            </el-card>
                        </el-col>
                    </el-row>
                    <!-- basic info card -->

                    <!-- end main content -->
                </el-col>
                <el-col :span="6" :offset="1">
                    <el-card>
                        <div slot="header">
                            <span>需求清单</span>
                        </div>
                        <el-autocomplete
                                class="inline-input"
                                v-model="state"
                                :fetch-suggestions="querySearch"
                                placeholder="请输入内容"
                                @select="handleSelect"
                        ></el-autocomplete>
                        <el-button type="primary">搜索</el-button>

                        <el-collapse v-model="activeNames" @change="handleChange" :key="index" v-for="(demand,index) in demands">
                            <el-collapse-item :title="demand.content" :name="index">
                                <div>待补充内容</div>
                            </el-collapse-item>
                        </el-collapse>
                    </el-card>

                </el-col>
            </el-row>
        </el-main>
        <el-footer>

        </el-footer>
    </el-container>
</div>
</body>
<!-- import axios -->
<script src="https://unpkg.com/axios/dist/axios.js"></script>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>

<script th:inline="javascript">
    let categoryId = [[${categoryId}]]
    let app = new Vue({
        el: '#app',
        data() {
            return {
                keyword: [[${keyword}]],
                items: [],
                demand: [],
                demandStrings: [],
                state: '',
                activeNames: ['1']
            }
        },
        created() {
            axios({
                url: '/getItemListByCategoryId',
                method: 'POST',
                params: {
                    categoryId: categoryId
                }
            })
                .then(res => {
                    this.items = res.data.data
                    this.items.forEach(function (item, idx) {
                        console.log(item.priceList.get(0).price)
                    })
                })
                .catch(err => {
                    // this.$message.error(err)
                }),
            axios({
                url: '/getNeedListByCategoryId',
                methods: 'POST',
                params: {
                    categoryId: categoryId
                }
            })
                .then(res => {
                    console.log(res.data.data);
                    this.demands = res.data.data;
                    for(let i = 0; i < this.demands.length; i++) {
                        this.demandStrings.push({
                            "id": this.demands[i].id,
                            "content": this.demands[i].content
                        })
                    }
                    // console.log(this.demandStrings);
                    // this.demandStrings = this.demandStrings.map(item => {
                    //     return Object.values(item)
                    // })
                    console.log(this.demandStrings);
                })
        },
        computed: {
            price(index) {
                return this.items[index].priceList[0].price
            }
        },
        methods: {
            price(index) {
                return this.items[index].priceList[0].price
            },
            querySearch(queryString, cb) {
                let demandStrings = this.demandStrings;
                let results = queryString ? demandStrings.filter(this.createFilter(queryString)) : demandStrings;
                // 调用 callback 返回建议列表的数据
                cb(results);
            },
            createFilter(queryString) {
                return (demandString) => {
                    return (demandString.value.indexOf(queryString) === 0);
                };
            },
            handleSelect(item) {
                console.log(item);
            },
            search() {
                if (app.keyword != null) {
                    window.location.href = 'search?keyword=' + app.keyword;
                }
            },
            report() {
                window.location.href = 'report?keyword=' + app.keyword;
            },
            singleAnalyst(skuId) {
                window.location.href = '/search?keyword=https://item.jd.com/' + skuId + '.html';
            },
            handleChange(val) {
                console.log(val);
            }
        }
    });

</script>
</html>